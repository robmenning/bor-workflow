# prefect.yaml
version: 2.0
deployments:
  - name: Mellon Holdings ETL
    entrypoint: src/workflows/mellon_holdings_etl.py:mellon_holdings_etl_flow
    work_pool:
      name: default-agent-pool
    parameters:
      source_files: [
        "/var/lib/mysql-files/ftpetl/incoming/mellon-660600017-AAD-20250414.csv",
        "/var/lib/mysql-files/ftpetl/incoming/mellon-660600027-AAD-20250414.csv", 
        "/var/lib/mysql-files/ftpetl/incoming/mellon-660610007-AAD-20250414.csv"
      ]
      db_host: "{{ $DB_HOST }}"
      db_port: "{{ $DB_PORT }}"
      db_user: "{{ $DB_USER }}"
      db_password: "{{ $DB_PASSWORD }}"
      db_name: "{{ $DB_NAME }}"
      target_dir: "/var/lib/mysql-files/ftpetl/incoming/"
      delimiter: ","
      quote_char: "\""
      line_terminator: "\n"
      skip_lines: 1
      truncate_before_load: false
  - name: Mellon Duration ETL
    entrypoint: src/workflows/mellon_duration_etl.py:mellon_duration_etl_flow
    work_pool:
      name: default-agent-pool
    parameters:
      source_files: [
        "/var/lib/mysql-files/ftpetl/incoming/660600017Duration_Report.csv",
        "/var/lib/mysql-files/ftpetl/incoming/660600027Duration_Report.csv", 
        "/var/lib/mysql-files/ftpetl/incoming/660610007Duration_Report.csv"
      ]
      db_host: "{{ $DB_HOST }}"
      db_port: "{{ $DB_PORT }}"
      db_user: "{{ $DB_USER }}"
      db_password: "{{ $DB_PASSWORD }}"
      db_name: "{{ $DB_NAME }}"
      target_dir: "/var/lib/mysql-files/ftpetl/incoming/"
      delimiter: ","
      quote_char: "\""
      line_terminator: "\n"
      skip_lines: 3
      truncate_before_load: false
  - name: Factset Out Holdings
    entrypoint: src/workflows/factset_out_hold.py:factset_out_hold_flow
    work_pool:
      name: default-agent-pool
    parameters:
      date_valid: "2025-04-14"
      port_id: null
      file_name: "holdings_yyyymmdd.txt"
      delimiter: "|"
      output_dir: "/var/lib/mysql-files/ftpetl/outgoing/"
      api_host: "bor-api"
      api_port: "{{ $API_PORT }}"
